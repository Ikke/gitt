<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Git In The Trenches</title>
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<link type="text/css" href="menu.css" rel="stylesheet" />
	<script type="text/javascript" src="jquery.js"></script>
	<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-228354-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>
<table width="1000" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
    <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td class="logo"><a href="index.html"><img src="images/git_logo_new.png" alt="Git In The Trenches" height="61" border="0"></a></td>
            <td class="nav">
				<a href="index.html">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="download.html">Download Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="intro.html">Read Now</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="http://github.com/cbx33/gitt">Source</a>&nbsp;&nbsp;|&nbsp;&nbsp;
				<a href="feedback.html">Feeback</a>
			</td>
          </tr>
        </table></td>
      </tr>
      <tr>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td class="main_content_pad"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td width="309"><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="subnav">
				<strong>Introduction</strong><br>
&bull;&nbsp;&nbsp;<a href="intro.html">How this book works</a><br>
<div class="divider"></div>
<strong>Setting up</strong><br>
&bull;&nbsp;&nbsp;<a href="setup.html">Making sure you have everything</a><br>
<div class="divider"></div>
<strong>Week 1</strong><br>
<span>&bull; Day 1 </span> - <a href="chap1-1.html"> "Things need to change"</a><br>
<span>&bull; Day 3 </span> - <a href="chap1-2.html"> "A possible solution"</a><br>
<span>&bull; Day 4 </span> - <a href="chap1-3.html"> "A decision is reached"</a><br>
<span>&bull; Day 5 </span> - <a href="chap1-4.html"> "Working like a team"</a><br>
<div class="divider"></div>
<strong>After Hours Week 1</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours1-1.html">"History Lesson"</a><br>
<div class="divider"></div>
<strong>Week 2</strong><br>
<span>&bull; Day 1 </span> - <a href="chap2-1.html"> "We are coders, we use Git!"</a><br>
<span>&bull; Day 2 </span> - <a href="chap2-2.html"> "Making commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap2-3.html"> "Let's do this right, not fast"</a><br>
<span>&bull; Summary </span> - <a href="chap2-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 2</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours2-1.html">"A Little Of Git's Internals"</a><br>
<div class="divider"></div>
<strong>Week 3</strong><br>
<span>&bull; Day 1 </span> - <a href="chap3-1.html"> "How do I see what's going on?"</a><br>
<span>&bull; Day 2 </span> - <a href="chap3-2.html"> "But I need more information"</a><br>
<span>&bull; Day 3 </span> - <a href="chap3-3.html"> "What actually changed?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap3-4.html"> "Finding a good reference point"</a><br>
<span>&bull; Day 5 </span> - <a href="chap3-5.html"> "Putting things back again"</a><br>
<span>&bull; Summary </span> - <a href="chap3-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 3</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours3-1.html">"A Closer Look At Diffs and Tags"</a><br>
<div class="divider"></div>
<strong>Week 4</strong><br>
<span>&bull; Day 1 </span> - <a href="chap4-1.html"> "We're getting somewhere"</a><br>
<span>&bull; Day 2 </span> - <a href="chap4-2.html"> "Branches galore"</a><br>
<span>&bull; Day 3 </span> - <a href="chap4-3.html"> "Tricking the twigs"</a><br>
<span>&bull; Day 4 </span> - <a href="chap4-4.html"> "I pressed delete..."</a><br>
<span>&bull; Day 5 </span> - <a href="chap4-5.html"> "Conflicting information"</a><br>
<span>&bull; Summary </span> - <a href="chap4-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 4</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-1.html">"Merge merge merge"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours4-2.html">"Grepping your life away"</a><br>
<div class="divider"></div>
<strong>Week 5</strong><br>
<span>&bull; Day 1 </span> - <a href="chap5-1.html"> "This isn't working for me John"</a><br>
<span>&bull; Day 2 </span> - <a href="chap5-2.html"> "Back to logging"</a><br>
<span>&bull; Day 4 </span> - <a href="chap5-3.html"> "Advanced Techniques"</a><br>
<span>&bull; Summary </span> - <a href="chap5-4.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 5</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours5-1.html">"Splitting up commits the easy way"</a><br>
<div class="divider"></div>
<strong>Week 6</strong><br>
<span>&bull; Day 1 </span> - <a href="chap6-1.html"> "My private little stash"</a><br>
<span>&bull; Day 2 </span> - <a href="chap6-2.html"> "What?! No backup?"</a><br>
<span>&bull; Day 3 </span> - <a href="chap6-3.html"> "Is this clone for real?"</a><br>
<span>&bull; Day 4 </span> - <a href="chap6-4.html"> "Help I'm no longer up to date?"</a><br>
<span>&bull; Day 5 </span> - <a href="chap6-5.html"> "I'm putting my foot down"</a><br>
<span>&bull; Summary </span> - <a href="chap6-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 6</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-1.html">"Tug of war"</a><br>
&bull;&nbsp;&nbsp;<a href="afterhours6-2.html">"Referring to objects"</a><br>
<div class="divider"></div>
<strong>Week 7</strong><br>
<span>&bull; Day 1 </span> - <a href="chap7-1.html"> "Networking with a difference"</a><br>
<span>&bull; Day 2 </span> - <a href="chap7-2.html"> "Now let's work together"</a><br>
<span>&bull; Day 3 </span> - <a href="chap7-3.html"> "Rebasing our commitments"</a><br>
<span>&bull; Day 4 </span> - <a href="chap7-4.html"> "Starting to get rebased"</a><br>
<span>&bull; Day 5 </span> - <a href="chap7-5.html"> "I could rebase the world"</a><br>
<span>&bull; Summary </span> - <a href="chap7-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 7</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours7-1.html">"Network Communicating"</a><br>
<div class="divider"></div>
<strong>Week 8</strong><br>
<span>&bull; Day 1 </span> - <a href="chap8-1.html"> "Give a man a patch"</a><br>
<span>&bull; Day 2 </span> - <a href="chap8-2.html"> "Looking for problems"</a><br>
<span>&bull; Day 3 </span> - <a href="chap8-3.html"> "Filtered repos"</a><br>
<span>&bull; Day 4 </span> - <a href="chap8-4.html"> "Let's make a library"</a><br>
<span>&bull; Day 5 </span> - <a href="chap8-5.html"> "Shhh....we're in a library"</a><br>
<span>&bull; Summary </span> - <a href="chap8-6.html"> John's Notes</a><br>
<div class="divider"></div>
<strong>After Hours Week 8</strong><br>
&bull;&nbsp;&nbsp;<a href="afterhours8-1.html">"Fishing for beginners"</a><br>
<div class="divider"></div>
<strong>A little extra help</strong><br>
&bull;&nbsp;&nbsp;<a href="chap9-1.html">Taking things further</a><br>
&bull;&nbsp;&nbsp;<a href="chap9-2.html">The end of the journey</a><br>
<div class="divider"></div>

				
				<td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table>              <h1>&nbsp;</h1>
              </td>
            <td><table width="100%"  border="0" cellspacing="0" cellpadding="0">
              <tr>
                <td class="read_content">
<h1>Week 3</h1><h2>Day 3 - "What actually changed?"</h2>
<h3>Doing the diff dance</h3>
Knowing what the committer thinks they committed is brilliant.
However, sometimes it's just not enough.
The reason for this is stated fairly precisely in the first sentence of this paragraph, so let us add a little formatting to bring out the real meaning.
Knowing what the committer <em>thinks</em> they committed is brilliant.
By looking at the commit message we only know as much as the committer wants us to.
If they are the helpful sort, this will probably be all that we need, most of the time.
On the other hand there is always the situation where you'd like to know a little more about what was actually placed into the repository.<br><br>The <code class="ncode">git diff</code> command can show us exactly that.
For more information about diff in general, see the diff breakout box in this chapter.
Think of a diff as an easy way of looking at the differences between two files, surrounded by a little context.
This can often be enhanced by a visual diff viewer, but for now, let's stick with our simple text based <code class="ncode">git diff</code>.<br><br>If we want to find out what the changes are between our current commit and one of the previous ones, we can write a command like the one below.
Notice that below, <strong>163f061</strong> refers to the second commit that we made to the repository.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git diff 163f061</strong><br/>
diff --git a/my_second_committed_file b/my_second_committed_file<br/>
index 3ad4cc3..095b9cd 100644<br/>
--- a/my_second_committed_file<br/>
+++ b/my_second_committed_file<br/>
@@ -1 +1,2 @@<br/>
 Change1<br/>
+Change2<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>What this is telling us, is that between <strong>163f061</strong> and our current commit <strong>9938a0c</strong>, we added the line <em>Change2</em> to the file <code class="ncode">my_second_committed_file</code>.
We can see this by the preceding <code class="ncode">+</code> on the line <code class="ncode">Change2</code>.
Let's make a few changes to our repository and see how the diffs look.
We're actually going to make a few changes to the files using a text editor so that you can't see what we've done.
Then, hopefully, when we run the <code class="ncode">git diff</code> you'll be able to see clearly what has happened.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log HEAD~1..HEAD</strong><br/>
commit a022d4d1edc69970b4e8b3fe1da3dccd943a55e4<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Thu Mar 31 22:05:55 2011 +0100<br/>
<br/>
    Messed with a few files<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>The command <code class="ncode">git log HEAD&#126;1..HEAD</code> tells Git to show us the git log for all commits between <code class="ncode">HEAD~1</code> and <code class="ncode">HEAD</code>.
The notation used here is something new to us, but seeing as HEAD points to the most current commit, HEAD~1 points to the commit previous to HEAD.
This is how we tell Git to show us only the most recently commit.<br><br>As it turns out, John Haskins didn't really create a very meaningful log message.
<em>Messed with a few files</em> is pretty unhelpful in the grand scheme of things.
So let's be thankful that this isn't Tamagoyaki Inc's core repository and take a look at what actually happened in the commit <strong>a022d4d</strong>.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git diff HEAD~1..HEAD</strong><br/>
diff --git a/my_second_committed_file b/my_second_committed_file<br/>
index 095b9cd..c9887f8 100644<br/>
--- a/my_second_committed_file<br/>
+++ b/my_second_committed_file<br/>
@@ -1,2 +1 @@<br/>
-Change1<br/>
-Change2<br/>
+Changed this file completely<br/>
diff --git a/my_third_committed_file b/my_third_committed_file<br/>
new file mode 100644<br/>
index 0000000..5d27866<br/>
--- /dev/null<br/>
+++ b/my_third_committed_file<br/>
@@ -0,0 +1 @@<br/>
+Addition to the line<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>As you can see, we have several things going on here, so let's take each of them in isolation and see what is going on.
We are going to dissect the diff to see what each section means.<br><div id="codeblock"><code>diff --git a/my_second_committed_file b/my_second_committed_file<br/>
</code></div><br>This first line tells us that we are dealing with <code class="ncode">my_second_committed_file</code>.
This is showing that we are comparing the first revision, or a, against the second revision, b.<br><div id="codeblock"><code>index 095b9cd..c9887f8 100644<br/>
</code></div><br>This second line actually tells us the beginning of the object IDs, as they are stored in the repository.
Note that these IDs are not the commit IDs, but the actual blob IDs that Git uses to refer to the file.
For more information on this, checkout the <em>Object's living in harmony</em> breakout box.<br><div id="codeblock"><code>--- a/my_second_committed_file<br/>
+++ b/my_second_committed_file<br/>
</code></div><br>The next few lines are telling us which is the original file, and which is the new file, so we can use this as a reference.<br><div id="codeblock"><code>@@ -1,2 +1 @@<br/>
-Change1<br/>
-Change2<br/>
+Changed this file completely<br/>
</code></div><br>Now we see a group of lines which are generally referred to as a hunk.
The hunk has two important pieces of information.
Section <code class="ncode">-1,2</code> tells us that in the original file, we are looking at the original file (<code class="ncode">-</code>), that the starting line where the change takes place is line 1 (<code class="ncode">1</code>) and that the hunk applies to two lines (<code class="ncode">2</code>).
The next section tells us that in the new file, the change takes place as line 1, and because the comma and remaining number are omitted, we can infer that the hunk applies to only 1 line.<br><br>The three following lines show what change actually took place.
Strings <code class="ncode">Change1</code> and <code class="ncode">Change2</code> were deleted from the file, whereas <code class="ncode">Changed this file completely</code> was added to the file.<br><br>Looking at the next diff segment, we can see it applies to a different file.
Essentially this hunk is no different to the last, the only interesting portion is shown below.<br><div id="codeblock"><code>new file mode 100644<br/>
index 0000000..5d27866<br/>
--- /dev/null<br/>
+++ b/my_third_committed_file<br/>
</code></div><br>This shows us that <code class="ncode">my_third_committed_file</code> is actually a new file.
Notice the <code class="ncode">/dev/null</code> and the <code class="ncode">0000000</code> object ID, indicating that there was no original file.<br><h3>Diffing Over A Range</h3>
All the operations that we have performed so far have been on one commit.
Whilst important and valuable, it may be that you want to see an entire range of changes.<br><div id="trenchblock"><strong>In the trenches...</strong><br>
"I'm still not entirely convinced about this John," said Martha.
"I've been playing around with Git, like you asked me, but it still just seems like we're replicating the work that we used to do with the readme changelogs and the tarball files."<br><br>She sat down on a near-by chair and wheeled it over to John's desk.
She surveyed the desk for an inch of vacant real estate before finally resting her elbow on the corner of his desk next to a copy of Pro Git.<br><br>"Well, actually Martha, I can see exactly what you mean. Up until now, there is no difference between the old and the new process. I'm still in control of all the versions, so nothing has really changed."
He thought long and hard, "Tell ya what. Why don't you give me an operation that you've always wanted to do against our code tree tarballs easily."<br><br>"Easy," she snapped back,
"I want to know what changes were made for the last two weeks whilst I had been away on holiday."
She smiled an almost mischievous smile as she referenced 'The Incident', as it had become known throughout the office.<br><br>"Easy," John quipped, mimicking her mannerisms.
The two broke out in laughter.
"We can use git log for that, and I think there are some date options too. Let me check the man page."
</div><br>Looking at the man page for git log is a mind trip for the uninitiated.
Weighing in at over 600 lines of text, it is abundantly clear that this tool does a whole lot more than viewing a simple history of commits to the repository.
It is well worth taking the time to read through the current available options by typing <code class="ncode">man git log</code> on the command line.
If you have the documentation installed, this will yield the <em>man</em> page for <code class="ncode">git log</code>.<br><br>Listing all commits in our repository is useful, being able to filter this output is fantastic.
This is one area in which the developers of Git have placed a great deal of time and effort.
For example, we can use <code class="ncode">git log</code> to not only show us the commit message, but also provide a diff output as well.
This means that for each commit entry in the output, we will see a diff as well.
Now, whilst we are further empowered by having the diff output in chronological order for each commit, we can take things further by filtering the commits.<br><br>Suppose we want to view all the commits that we made in the last week, typing the following into the command line in our test repository yields the following result.
<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log -p --since="last week"</strong><br/>
commit a022d4d1edc69970b4e8b3fe1da3dccd943a55e4<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Thu Mar 31 22:05:55 2011 +0100<br/>
<br/>
    Messed with a few files<br/>
<br/>
diff --git a/my_second_committed_file b/my_second_committed_file<br/>
index 095b9cd..c9887f8 100644<br/>
--- a/my_second_committed_file<br/>
+++ b/my_second_committed_file<br/>
@@ -1,2 +1 @@<br/>
-Change1<br/>
-Change2<br/>
+Changed this file completely<br/>
diff --git a/my_third_committed_file b/my_third_committed_file<br/>
new file mode 100644<br/>
index 0000000..5d27866<br/>
--- /dev/null<br/>
+++ b/my_third_committed_file<br/>
@@ -0,0 +1 @@<br/>
+Addition to the line<br/>
...<br/>
...<br/>
</code></div><br>Notice we get to see the diff that was presented before when we ran our <code class="ncode">git diff HEAD&#126;1..HEAD</code> command, but this time, as we have used the git log command instead, we get to see the diff output as well.
This is what the <code class="ncode">-p</code> flag is for.
Take note of the way we have specified the time period that we are interested in.
The section <code class="ncode">--since="last week"</code> tells Git to filter the output and show only the entries that were committed within the last week.<br><br>This type of filtering can be exceedingly useful to a developer.
Often when problems arise, you do not have a defined point in time that you know when your code was last working.
However most of the time, you can say with some certainty, "I know it was working two weeks ago".
Using the methods described above, will give the user all of the changes, categorised by commit, that occurred in those two weeks, allowing them to narrow down the scope of exactly where to begin looking for the offending changes.<br><br>If the developer can further categorise the issue, such as, "I know which file the change must have occurred in", then the following example will demonstrate just how easy it is to filter the results even further.
Even in the simplified example repository that we have been using, running this command filters the output to a single file.<br><div id="codeblock"><code><strong>john@satsuki:~/coderepo$ git log -p --since="last week" -- my_second_committed_file</strong><br/>
commit a022d4d1edc69970b4e8b3fe1da3dccd943a55e4<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Thu Mar 31 22:05:55 2011 +0100<br/>
<br/>
    Messed with a few files<br/>
<br/>
diff --git a/my_second_committed_file b/my_second_committed_file<br/>
index 095b9cd..c9887f8 100644<br/>
--- a/my_second_committed_file<br/>
+++ b/my_second_committed_file<br/>
@@ -1,2 +1 @@<br/>
-Change1<br/>
-Change2<br/>
+Changed this file completely<br/>
<br/>
commit 9938a0c30940dccaeddce4bb2eb151fba3a21ae5<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Thu Mar 31 20:34:23 2011 +0100<br/>
<br/>
    Finished adding initial files<br/>
<br/>
diff --git a/my_second_committed_file b/my_second_committed_file<br/>
index 3ad4cc3..095b9cd 100644<br/>
--- a/my_second_committed_file<br/>
+++ b/my_second_committed_file<br/>
@@ -1 +1,2 @@<br/>
 Change1<br/>
+Change2<br/>
<br/>
commit 163f06147a449e724d0cfd484c3334709e8e1fce<br/>
Author: John Haskins &lt;john.haskins@tamagoyakiinc.koala&gt;<br/>
Date:   Thu Mar 31 20:32:59 2011 +0100<br/>
<br/>
    Made a few changes to first and second files<br/>
<br/>
diff --git a/my_second_committed_file b/my_second_committed_file<br/>
new file mode 100644<br/>
index 0000000..3ad4cc3<br/>
--- /dev/null<br/>
+++ b/my_second_committed_file<br/>
@@ -0,0 +1 @@<br/>
+Change1<br/>
<strong>john@satsuki:~/coderepo$</strong><br/>
</code></div><br>See how easy that is.
Note, the <code class="ncode">--</code> is necessary to tell Git the following string is a path.
We no longer have the information for <code class="ncode">my_third_committed_file</code> present in the output.
We have filtered everything out but the information we are looking for.
When you are up against deadlines, pouring through pages and pages of diffs and changes can be incredibly time consuming.
Having the tools available to cut that output down to just the relevant material can be life saving.<br><br><table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td><p align="left"><a href="chap3-2.html"><img src="images/prev.png" alt="Previous Day" height="29" border="0"></a></p></td>
						<td><p align="right"><a href="chap3-4.html"><img src="images/next.png" alt="Next Day" height="29" border="0"></a></p></td>
					</tr>
				</table>                  </td>
                <td class="fade_right">&nbsp;</td>
              </tr>
              <tr>
                <td class="fade_bot">&nbsp;</td>
                <td class="fade_corner">&nbsp;</td>
              </tr>
            </table></td>
            </tr>
          </table>
		</td>
      </tr>
      <tr>
        <td class="foot"><a href="index.html">home</a> | <a href="download.html">download</a> | <a href="intro.html">read now</a> | <a href="http://github.com/cbx33/gitt">source</a> | <a href="feedback.html">feedback</a> | <a href="legal.html">legal stuff</a><br>
        </td>
      </tr>
    </table></td>
  </tr>
</table>
</body>
</html>
